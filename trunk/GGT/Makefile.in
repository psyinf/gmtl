# =============================================================================
# $Id: Makefile.in,v 1.1.1.1 2002-01-18 20:43:10 allenb Exp $
#
# Base Makefile.in for the gfx source.  It requires GNU make.
#
# Generated for use on @PLATFORM@
# -----------------------------------------------------------------------------
# world        - Build and install everything.
# buildworld   - Build everything (same as 'all').
# installworld - Install everything (same as 'install-all').  This requires
#                that 'buildworld' be successfully completed beforehand.
#
# all          - Build everything.
# debug        - Build the VR Juggler libraries (dynamic and static) with
#                debugging symbols turned on.
# dbg          - Build the debugging, static copy of the libraries.
# ddso         - Build the debugging, dynamic shared object version of the
#                libraries.
# optim        - Build the VR Juggler libraries (dynamic and static) with
#                optimization flags enabled.
# opt          - Build the optimized, static version of the libraries.
# dso          - Build the dynamic shared object version of the libraries.
# java         - Build the Java class files.
#
# static-libs  - Build the static version of the libraries.  This target
#                depends on a correct value for $(LIBDIR) (that does not
#                have a default value).
# shared-libs  - Build the dynamic shared version of the libraries.  This
#                target depends on a correct value for $(LIBDIR) (that does
#                not have a default value).
#
# clean        - Clean up everything (uses common 'clean' target).
# cleandepend  - Clean up the dependency files (uses common 'cleandepend'
#                target).
# clobber      - Clean up everything and remove the directories containing
#                the compiled libraries and its object files.
#
# info         - Print out information about the build process that may be
#                useful to the user.
#
# The default target is 'debug'.
# =============================================================================

default: dbg

# Include common definitions.
include @topdir@/make.defs.mk

# Subdirectories used for recursion through the source tree.
SUBDIR		= Threads \
              GMTL \
			  SGA

# Record the time at which the build started.
STARTTIME	:= $(shell LC_TIME=C date)

# =============================================================================
# Library targets.  The default is 'debug' as defined above.  The steps for
# building the 'dbg', 'ddso', 'opt' and 'dso' are as follows:
#
#    1) Generate code from IDL files.
#    2) Build dependencies (if necessary).
#    3) Compile all object files that are out of date.
#    4) Compile the actual libraries from the object files.
# =============================================================================

# ------------------------------------------------
# Build and install everything (i.e., the world).
# ------------------------------------------------
world:
	@echo "------------------------------------------------------------"
	@echo ">>> make world started on $(STARTTIME)"
	@echo "------------------------------------------------------------"
ifndef NO_CLEAN
	@$(MAKE) clobber
endif
	@$(MAKE) buildworld
	@$(MAKE) installworld
	@echo "------------------------------------------------------------"
	@echo ">>> make world started on $(STARTTIME)"
	@echo ">>> make world completed on `LC_TIME=C date`"
	@echo "------------------------------------------------------------"

# ------------------------------------------
# Build all four versions of the libraries.
# ------------------------------------------
buildworld all:
	@echo "------------------------------------------------------------"
	@echo "Building everything"
	@echo "------------------------------------------------------------"
	@$(MAKE) _IDL_TARGET="idl jidl" beforebuild
	@$(MAKE) libs
	@$(MAKE) afterbuild
	@echo "------------------------------------------------------------"
	@echo "$@ complete"
	@echo "------------------------------------------------------------"

installworld install-all:
	@echo "------------------------------------------------------------"
	@echo "Installing everything"
	@echo "------------------------------------------------------------"
	@echo "------------------------------------------------------------"
	@echo "$@ complete"
	@echo "------------------------------------------------------------"

# -----------------------------------------------------------------------------
# Make the debugging version of the libraries building both static and shared
# versions of the library binaries.
# -----------------------------------------------------------------------------
debug:
	@echo "------------------------------------------------------------"
	@echo "Building debugging version"
	@echo "------------------------------------------------------------"
	@$(MAKE) _IDL_TARGET="idl" beforebuild
	@$(MAKE) _build_dbg_obj
	@$(MAKE) _build_dbg_lib_static
	@$(MAKE) _build_dbg_lib_dynamic
	@$(MAKE) afterbuild
	@echo "------------------------------------------------------------"
	@echo "$@ complete"
	@echo "------------------------------------------------------------"

# -----------------------------------------------------------------------------
# Make the optimized version of the libraries building both static and shared
# versions of the library binaries.
# -----------------------------------------------------------------------------
optim:
	@echo "------------------------------------------------------------"
	@echo "Building optimized version"
	@echo "------------------------------------------------------------"
	@$(MAKE) _IDL_TARGET="idl" beforebuild
	@$(MAKE) _build_opt_obj
	@$(MAKE) _build_opt_lib_static
	@$(MAKE) _build_opt_lib_dynamic
	@$(MAKE) afterbuild
	@echo "------------------------------------------------------------"
	@echo "$@ complete"
	@echo "------------------------------------------------------------"

# -----------------------------------------------------------------------------
# Make the Java class files.
# -----------------------------------------------------------------------------
java:
	@echo "------------------------------------------------------------"
	@echo "Building Java skeleton code"
	@echo "------------------------------------------------------------"
	@$(MAKE) _IDL_TARGET="jidl" beforebuild
	@$(MAKE) _build_java
	@$(MAKE) _build_dso_jar
	@$(MAKE) afterbuild
	@echo "------------------------------------------------------------"
	@echo "$@ complete"
	@echo "------------------------------------------------------------"

# =============================================================================
# Human-readable information about the build system.
# =============================================================================
info::
	@echo "\nInfo for the make of $(BSYS_LIBRARY)"
	@echo "BSYS_SRC_ROOT_ABS: $(BSYS_SRC_ROOT_ABS)"
	@echo "Default ABI: $(ABI)"
	@echo "Default instruction set architecture: $(ISA)"
	@echo "ABI list: $(ABI_LIST)"
	@echo "DBG_BUILDDIR: $(_DBG_BUILDDIR)"
	@echo "OPT_BUILDDIR: $(_OPT_BUILDDIR)"
	@echo "Installation prefix: $(prefix)"
	@echo "libdir: $(libdir)"
	@$(SHELL) $(scriptdir)/print-targets.sh

# Include recursive target code and all the specialized targets for use in
# building the source tree.
include $(MKPATH)/bsys.subdir.mk
include Makefile.inc
